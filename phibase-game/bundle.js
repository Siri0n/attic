(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (global){
"use strict";

var Phaser = (typeof window !== "undefined" ? window['Phaser'] : typeof global !== "undefined" ? global['Phaser'] : null);

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', "game", true);

game.state.add("game", function () {
	return {
		preload: function preload() {
			game.load.spritesheet("tile", "assets/tile.png", 48, 72);
			game.load.image("dot", "assets/dot.png");
			game.load.start();
		},
		create: function create() {
			var field = window.field = new Field({
				game: game,
				rect: {
					x: 30,
					y: 30,
					h: 540,
					w: 740
				}
			});
		}
	};
}());

function Field(_ref) {
	var game = _ref.game;
	var rect = _ref.rect;

	var grid = {
		tileWidth: 48,
		tileHeight: 72,
		margin: 6
	};
	var cols = 11;
	var rows = 6;
	var dotcol = 6;

	var group = game.add.group();

	var dots = game.add.group(group);
	dots.x = (dotcol - 1) * (grid.tileWidth + grid.margin);
	for (var i = 0; i < rows; i++) {
		var img = game.add.image(-grid.margin / 2, i * (grid.tileHeight + grid.margin) + grid.tileHeight, "dot");
		img.anchor.x = img.anchor.y = 0.5;
		dots.add(img);
	}
	var tiles = [];
	var afterTweenStop = [];
	var tweenCounter = 0;
	var events = {
		beginTween: function beginTween() {
			tweenCounter++;
			console.log(tweenCounter);
		},
		endTween: function endTween() {
			console.log(--tweenCounter);
			if (!tweenCounter) {
				console.log("lol");
				while (afterTweenStop.length) {
					afterTweenStop.pop()();
				}
			}
		},
		click: function click(tile) {
			var i = tile.y,
			    j = tile.x;
			if (j >= cols - 2) {
				return;
			}
			var checksum1 = tile.value + tiles[i][j + 1].value;
			var checksum2 = tile.value + tiles[i][j + 2].value;
			if (checksum1 != 1 || checksum2 != 1) {
				return;
			}
			if (tile.value) {
				tile.switch();
				tiles[i][j + 1].switch();
				tiles[i][j + 2].switch();
				tiles[i][j + 1].moveAndBack(-1, 0);
				tiles[i][j + 2].moveAndBack(-2, 0);
				afterTweenStop.push(function () {
					return adjust(rect);
				});
			} else {
				tiles[i][j + 1].moveAndBack(-1, 0, true);
				tiles[i][j + 2].moveAndBack(-2, 0, true);
				afterTweenStop.push(function () {
					tile.switch();
					tiles[i][j + 1].switch();
					tiles[i][j + 2].switch();
					adjust(rect);
				});
			}
		}
	};
	for (var _i = 0; _i < rows; _i++) {
		var row = [];
		for (var j = 0; j < cols; j++) {
			var value = void 0;
			if (j == 0 || j > cols - 3) {
				value = 0;
			} else {
				value = Math.random() > 0.5 ? 0 : 1;
			}
			row.push(new Tile({
				game: game,
				group: group,
				grid: grid,
				x: j,
				y: _i,
				value: value,
				events: events
			}));
		}
		tiles.push(row);
	}
	function adjust(rect, init) {
		if (columnHasUnit(cols - 1) || columnHasUnit(cols - 2)) {
			addColumn();
			if (columnHasUnit(cols - 2)) {
				addColumn();
			}
		} else {
			while (!columnHasUnit(cols - 1) && !columnHasUnit(cols - 2) && !columnHasUnit(cols - 3)) {
				removeColumn();
			}
		}

		if (columnHasUnit(0)) {
			addColumn(true);
		} else {
			while (!columnHasUnit(0) && !columnHasUnit(1)) {
				removeColumn(true);
			}
		}

		var width = (grid.tileWidth + grid.margin) * cols - grid.margin;
		var height = (grid.tileHeight + grid.margin) * rows - grid.margin;
		var scale = Math.min(rect.w / width, rect.h / height);
		width *= scale;
		height *= scale;
		if (init) {
			group.x = rect.x + (rect.w - width) / 2;
			group.y = rect.y + (rect.h - height) / 2;
			group.scale.x = group.scale.y = scale;
			dots.x = dotcol * (grid.tileWidth + grid.margin);
		} else {
			game.add.tween(group).to({ x: rect.x + (rect.w - width) / 2, y: rect.y + (rect.h - height) / 2 }, 300, "Linear", true);
			game.add.tween(group.scale).to({ x: scale, y: scale }, 300, "Linear", true);
			game.add.tween(dots).to({ x: dotcol * (grid.tileWidth + grid.margin) }, 300, "Linear", true);
		}
	}
	adjust(rect, true);

	function columnHasUnit(i) {
		var f = false;
		for (var _j = 0; _j < rows; _j++) {
			f = f || tiles[_j][i].value;
		}
		return f;
	}

	function addColumn(leftSide) {
		cols++;
		leftSide && dotcol++;
		for (var _i2 = 0; _i2 < rows; _i2++) {
			var newTile = new Tile({
				game: game,
				group: group,
				grid: grid,
				x: cols - 1,
				y: _i2,
				value: 0,
				events: events
			});
			if (leftSide) {
				newTile.x = -1;
				tiles[_i2].unshift(newTile);
				tiles[_i2].forEach(function (tile, index) {
					return tile.moveX(index);
				});
			} else {
				tiles[_i2].push(newTile);
			}
		}
	}
	function removeColumn(leftSide) {
		cols--;
		leftSide && dotcol--;
		for (var _i3 = 0; _i3 < rows; _i3++) {
			if (leftSide) {
				tiles[_i3].shift().destroy();
				tiles[_i3].forEach(function (tile, index) {
					return tile.moveX(index);
				});
			} else {
				tiles[_i3].pop().destroy();
			}
		}
	}
}

function Tile(_ref2) {
	var game = _ref2.game;
	var group = _ref2.group;
	var grid = _ref2.grid;
	var x = _ref2.x;
	var y = _ref2.y;
	var value = _ref2.value;
	var events = _ref2.events;

	var self = this;
	var g = game.add.sprite(x * (grid.tileWidth + grid.margin), y * (grid.tileHeight + grid.margin), "tile", value);
	group.add(g);
	g.inputEnabled = true;
	g.events.onInputDown.add(function () {
		return events.click(self);
	});

	this.moveAndBack = function (dx, dy, flag) {
		var gx = g.x,
		    gy = g.y;
		events.beginTween();
		if (flag) {
			game.add.tween(g).to({
				x: (x + dx) * (grid.tileWidth + grid.margin),
				y: (y + dy) * (grid.tileHeight + grid.margin)
			}, 300, "Linear", true).chain(game.add.tween(g).from({ alpha: 0 }, 200, "Linear")).onComplete.add(function () {
				g.x = gx;
				g.y = gy;
				events.endTween();
			});
		} else {
			g.x = (x + dx) * (grid.tileWidth + grid.margin);
			g.y = (y + dy) * (grid.tileHeight + grid.margin);
			game.add.tween(g).to({ x: gx, y: gy }, 300, "Linear", true).onComplete.add(events.endTween);
		}
	};

	this.switch = function () {
		value = 1 - value;
		g.frame = value;
	};

	this.destroy = function () {
		g.destroy();
	};

	this.moveX = function (_) {
		x = _;
		game.add.tween(g).to({ x: x * (grid.tileWidth + grid.margin) }, 300, "Linear", true);
	};
	Object.defineProperties(this, {
		value: {
			get: function get() {
				return value;
			},
			set: function set(_) {
				value = _;
				g.frame = value;
			}
		},
		x: {
			get: function get() {
				return x;
			},
			set: function set(_) {
				x = _;
				g.x = x * (grid.tileWidth + grid.margin);
			}
		},
		y: {
			get: function get() {
				return y;
			},
			set: function set(_) {
				y = _;
				g.y = y * (grid.tileHeight + grid.margin);
			}
		}
	});
}

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJtYWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FDQUEsSUFBSSxTQUFTLFFBQVEsUUFBUixDQUFiOztBQUVBLElBQUksT0FBTyxJQUFJLE9BQU8sSUFBWCxDQUFnQixHQUFoQixFQUFxQixHQUFyQixFQUEwQixPQUFPLElBQWpDLEVBQXVDLEVBQXZDLEVBQTJDLE1BQTNDLEVBQW1ELElBQW5ELENBQVg7O0FBRUEsS0FBSyxLQUFMLENBQVcsR0FBWCxDQUFlLE1BQWYsRUFBd0IsWUFBVTtBQUNqQyxRQUFPO0FBQ04sU0FETSxxQkFDRztBQUNSLFFBQUssSUFBTCxDQUFVLFdBQVYsQ0FBc0IsTUFBdEIsRUFBOEIsaUJBQTlCLEVBQWlELEVBQWpELEVBQXFELEVBQXJEO0FBQ0EsUUFBSyxJQUFMLENBQVUsS0FBVixDQUFnQixLQUFoQixFQUF1QixnQkFBdkI7QUFDQSxRQUFLLElBQUwsQ0FBVSxLQUFWO0FBQ0EsR0FMSztBQU1OLFFBTk0sb0JBTUU7QUFDUCxPQUFJLFFBQVEsT0FBTyxLQUFQLEdBQWUsSUFBSSxLQUFKLENBQVU7QUFDcEMsY0FEb0M7QUFFcEMsVUFBTTtBQUNMLFFBQUcsRUFERTtBQUVMLFFBQUcsRUFGRTtBQUdMLFFBQUcsR0FIRTtBQUlMLFFBQUc7QUFKRTtBQUY4QixJQUFWLENBQTNCO0FBU0E7QUFoQkssRUFBUDtBQWtCQSxDQW5Cc0IsRUFBdkI7O0FBdUJBLFNBQVMsS0FBVCxPQUE0QjtBQUFBLEtBQVosSUFBWSxRQUFaLElBQVk7QUFBQSxLQUFOLElBQU0sUUFBTixJQUFNOztBQUMzQixLQUFNLE9BQU87QUFDWixhQUFXLEVBREM7QUFFWixjQUFZLEVBRkE7QUFHWixVQUFRO0FBSEksRUFBYjtBQUtBLEtBQUksT0FBTyxFQUFYO0FBQ0EsS0FBSSxPQUFPLENBQVg7QUFDQSxLQUFJLFNBQVMsQ0FBYjs7QUFFQSxLQUFJLFFBQVEsS0FBSyxH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LFlBQVU7QUFDeEIsSUFBRSxPQUFGO0FBQ0EsRUFGRDs7QUFJQSxNQUFLLEtBQUwsR0FBYSxVQUFTLENBQVQsRUFBVztBQUN2QixNQUFJLENBQUo7QUFDQSxPQUFLLEdBQUwsQ0FBUyxLQUFULENBQWUsQ0FBZixFQUFrQixFQUFsQixDQUFxQixFQUFDLEdBQUcsS0FBRyxLQUFLLFNBQUwsR0FBaUIsS0FBSyxNQUF6QixDQUFKLEVBQXJCLEVBQTRELEdBQTVELEVBQWlFLFFBQWpFLEVBQTJFLElBQTNFO0FBQ0EsRUFIRDtBQUlBLFFBQU8sZ0JBQVAsQ0FBd0IsSUFBeEIsRUFBOEI7QUFDN0IsU0FBTztBQUNOLFFBQUs7QUFBQSxXQUFNLEtBQU47QUFBQSxJQURDO0FBRU4sUUFBSyxhQUFTLENBQVQsRUFBVztBQUNmLFlBQVEsQ0FBUjtBQUNBLE1BQUUsS0FBRixHQUFVLEtBQVY7QUFDQTtBQUxLLEdBRHNCO0FBUTdCLEtBQUc7QUFDRixRQUFLO0FBQUEsV0FBTSxDQUFOO0FBQUEsSUFESDtBQUVGLFFBQUssYUFBUyxDQUFULEVBQVc7QUFDZixRQUFJLENBQUo7QUFDQSxNQUFFLENBQUYsR0FBTSxLQUFHLEtBQUssU0FBTCxHQUFpQixLQUFLLE1BQXpCLENBQU47QUFDQTtBQUxDLEdBUjBCO0FBZTdCLEtBQUc7QUFDRixRQUFLO0FBQUEsV0FBTSxDQUFOO0FBQUEsSUFESDtBQUVGLFFBQUssYUFBUyxDQUFULEVBQVc7QUFDZixRQUFJLENBQUo7QUFDQSxNQUFFLENBQUYsR0FBTSxLQUFHLEtBQUssVUFBTCxHQUFrQixLQUFLLE1BQTFCLENBQU47QUFDQTtBQUxDO0FBZjBCLEVBQTlCO0FBd0JBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsInZhciBQaGFzZXIgPSByZXF1aXJlKFwicGhhc2VyXCIpO1xyXG5cclxudmFyIGdhbWUgPSBuZXcgUGhhc2VyLkdhbWUoODAwLCA2MDAsIFBoYXNlci5BVVRPLCAnJywgXCJnYW1lXCIsIHRydWUpO1xyXG5cclxuZ2FtZS5zdGF0ZS5hZGQoXCJnYW1lXCIsIChmdW5jdGlvbigpe1xyXG5cdHJldHVybiB7XHJcblx0XHRwcmVsb2FkKCl7XHJcblx0XHRcdGdhbWUubG9hZC5zcHJpdGVzaGVldChcInRpbGVcIiwgXCJhc3NldHMvdGlsZS5wbmdcIiwgNDgsIDcyKTtcclxuXHRcdFx0Z2FtZS5sb2FkLmltYWdlKFwiZG90XCIsIFwiYXNzZXRzL2RvdC5wbmdcIik7XHJcblx0XHRcdGdhbWUubG9hZC5zdGFydCgpO1xyXG5cdFx0fSxcclxuXHRcdGNyZWF0ZSgpe1xyXG5cdFx0XHR2YXIgZmllbGQgPSB3aW5kb3cuZmllbGQgPSBuZXcgRmllbGQoe1xyXG5cdFx0XHRcdGdhbWUsXHJcblx0XHRcdFx0cmVjdDoge1xyXG5cdFx0XHRcdFx0eDogMzAsXHJcblx0XHRcdFx0XHR5OiAzMCxcclxuXHRcdFx0XHRcdGg6IDU0MCxcclxuXHRcdFx0XHRcdHc6IDc0MFxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fVxyXG59KSgpKTtcclxuXHJcblxyXG5cclxuZnVuY3Rpb24gRmllbGQoe2dhbWUsIHJlY3R9KXtcclxuXHRjb25zdCBncmlkID0ge1xyXG5cdFx0dGlsZVdpZHRoOiA0OCxcclxuXHRcdHRpbGVIZWlnaHQ6IDcyLFxyXG5cdFx0bWFyZ2luOiA2XHJcblx0fTtcclxuXHR2YXIgY29scyA9IDExO1xyXG5cdHZhciByb3dzID0gNjtcclxuXHR2YXIgZG90Y29sID0gNjtcclxuXHJcblx0dmFyIGdyb3VwID0gZ2FtZS5hZGQuZ3JvdXAoKTtcclxuXHJcblx0dmFyIGRvdHMgPSBnYW1lLmFkZC5ncm91cChncm91cCk7XHJcblx0ZG90cy54ID0gKGRvdGNvbCAtIDEpKihncmlkLnRpbGVXaWR0aCArIGdyaWQubWFyZ2luKTtcclxuXHRmb3IobGV0IGkgPSAwOyBpIDwgcm93czsgaSsrKXtcclxuXHRcdGxldCBpbWcgPSBnYW1lLmFkZC5pbWFnZSgtZ3JpZC5tYXJnaW4vMiwgaSooZ3JpZC50aWxlSGVpZ2h0ICsgZ3JpZC5tYXJnaW4pICsgZ3JpZC50aWxlSGVpZ2h0LCBcImRvdFwiKTtcclxuXHRcdGltZy5hbmNob3IueCA9IGltZy5hbmNob3IueSA9IDAuNTtcclxuXHRcdGRvdHMuYWRkKGltZyk7XHJcblx0fVxyXG5cdHZhciB0aWxlcyA9IFtdO1xyXG5cdHZhciBhZnRlclR3ZWVuU3RvcCA9IFtdO1xyXG5cdHZhciB0d2VlbkNvdW50ZXIgPSAwO1xyXG5cdHZhciBldmVudHMgPSB7XHJcblx0XHRiZWdpblR3ZWVuKCl7XHJcblx0XHRcdHR3ZWVuQ291bnRlcisrO1xyXG5cdFx0XHRjb25zb2xlLmxvZyh0d2VlbkNvdW50ZXIpO1xyXG5cdFx0fSxcclxuXHRcdGVuZFR3ZWVuKCl7XHJcblx0XHRcdGNvbnNvbGUubG9nKC0tdHdlZW5Db3VudGVyKTtcclxuXHRcdFx0aWYoIXR3ZWVuQ291bnRlcil7XHJcblx0XHRcdFx0Y29uc29sZS5sb2coXCJsb2xcIik7XHJcblx0XHRcdFx0d2hpbGUoYWZ0ZXJUd2VlblN0b3AubGVuZ3RoKXtcclxuXHRcdFx0XHRcdGFmdGVyVHdlZW5TdG9wLnBvcCgpKCk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0Y2xpY2sodGlsZSl7XHJcblx0XHRcdHZhciBpID0gdGlsZS55LFxyXG5cdFx0XHRcdGogPSB0aWxlLng7XHJcblx0XHRcdGlmKGogPj0gY29scyAtIDIpe1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0XHR2YXIgY2hlY2tzdW0xID0gdGlsZS52YWx1ZSArIHRpbGVzW2ldW2ogKyAxXS52YWx1ZTtcclxuXHRcdFx0dmFyIGNoZWNrc3VtMiA9IHRpbGUudmFsdWUgKyB0aWxlc1tpXVtqICsgMl0udmFsdWU7XHJcblx0XHRcdGlmKGNoZWNrc3VtMSAhPSAxIHx8IGNoZWNrc3VtMiAhPSAxKXtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdFx0aWYodGlsZS52YWx1ZSl7XHJcblx0XHRcdFx0dGlsZS5zd2l0Y2goKTtcclxuXHRcdFx0XHR0aWxlc1tpXVtqICsgMV0uc3dpdGNoKCk7XHJcblx0XHRcdFx0dGlsZXNbaV1baiArIDJdLnN3aXRjaCgpO1xyXG5cdFx0XHRcdHRpbGVzW2ldW2ogKyAxXS5tb3ZlQW5kQmFjaygtMSwgMCk7XHJcblx0XHRcdFx0dGlsZXNbaV1baiArIDJdLm1vdmVBbmRCYWNrKC0yLCAwKTtcclxuXHRcdFx0XHRhZnRlclR3ZWVuU3RvcC5wdXNoKCgpID0+IGFkanVzdChyZWN0KSk7XHJcblx0XHRcdH1lbHNle1xyXG5cdFx0XHRcdHRpbGVzW2ldW2ogKyAxXS5tb3ZlQW5kQmFjaygtMSwgMCwgdHJ1ZSk7XHJcblx0XHRcdFx0dGlsZXNbaV1baiArIDJdLm1vdmVBbmRCYWNrKC0yLCAwLCB0cnVlKTtcclxuXHRcdFx0XHRhZnRlclR3ZWVuU3RvcC5wdXNoKGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0XHR0aWxlLnN3aXRjaCgpO1xyXG5cdFx0XHRcdFx0dGlsZXNbaV1baiArIDFdLnN3aXRjaCgpO1xyXG5cdFx0XHRcdFx0dGlsZXNbaV1baiArIDJdLnN3aXRjaCgpO1xyXG5cdFx0XHRcdFx0YWRqdXN0KHJlY3QpO1xyXG5cdFx0XHRcdH0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cdGZvcihsZXQgaSA9IDA7IGkgPCByb3dzOyBpKyspe1xyXG5cdFx0bGV0IHJvdyA9IFtdO1xyXG5cdFx0Zm9yKGxldCBqID0gMDsgaiA8IGNvbHM7IGorKyl7XHJcblx0XHRcdGxldCB2YWx1ZTtcclxuXHRcdFx0aWYoaiA9PSAwIHx8IGogPiBjb2xzIC0gMyl7XHJcblx0XHRcdFx0dmFsdWUgPSAwO1xyXG5cdFx0XHR9ZWxzZXtcclxuXHRcdFx0XHR2YWx1ZSA9IE1hdGgucmFuZG9tKCkgPiAwLjUgPyAwIDogMTtcclxuXHRcdFx0fVxyXG5cdFx0XHRyb3cucHVzaChuZXcgVGlsZSh7XHJcblx0XHRcdFx0Z2FtZSxcclxuXHRcdFx0XHRncm91cCxcclxuXHRcdFx0XHRncmlkLFxyXG5cdFx0XHRcdHg6IGosXHJcblx0XHRcdFx0eTogaSxcclxuXHRcdFx0XHR2YWx1ZSxcclxuXHRcdFx0XHRldmVudHNcclxuXHRcdFx0fSkpO1xyXG5cdFx0fVxyXG5cdFx0dGlsZXMucHVzaChyb3cpO1xyXG5cdH1cclxuXHRmdW5jdGlvbiBhZGp1c3QocmVjdCwgaW5pdCl7XHJcblx0XHRpZihjb2x1bW5IYXNVbml0KGNvbHMtMSkgfHwgY29sdW1uSGFzVW5pdChjb2xzLTIpKXtcclxuXHRcdFx0YWRkQ29sdW1uKCk7XHJcblx0XHRcdGlmKGNvbHVtbkhhc1VuaXQoY29scy0yKSl7XHJcblx0XHRcdFx0YWRkQ29sdW1uKCk7XHJcblx0XHRcdH1cclxuXHRcdH1lbHNle1xyXG5cdFx0XHR3aGlsZSghY29sdW1uSGFzVW5pdChjb2xzLTEpICYmICFjb2x1bW5IYXNVbml0KGNvbHMtMikgJiYgIWNvbHVtbkhhc1VuaXQoY29scy0zKSl7XHJcblx0XHRcdFx0cmVtb3ZlQ29sdW1uKCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHRpZihjb2x1bW5IYXNVbml0KDApKXtcclxuXHRcdFx0YWRkQ29sdW1uKHRydWUpO1xyXG5cdFx0fWVsc2V7XHJcblx0XHRcdHdoaWxlKCFjb2x1bW5IYXNVbml0KDApICYmICFjb2x1bW5IYXNVbml0KDEpKXtcclxuXHRcdFx0XHRyZW1vdmVDb2x1bW4odHJ1ZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHJcblx0XHR2YXIgd2lkdGggPSAoZ3JpZC50aWxlV2lkdGggKyBncmlkLm1hcmdpbikqY29scyAtIGdyaWQubWFyZ2luO1xyXG5cdFx0dmFyIGhlaWdodCA9IChncmlkLnRpbGVIZWlnaHQgKyBncmlkLm1hcmdpbikqcm93cyAtIGdyaWQubWFyZ2luO1xyXG5cdFx0dmFyIHNjYWxlID0gTWF0aC5taW4ocmVjdC53L3dpZHRoLCByZWN0LmgvaGVpZ2h0KTtcclxuXHRcdHdpZHRoICo9IHNjYWxlO1xyXG5cdFx0aGVpZ2h0ICo9IHNjYWxlO1xyXG5cdFx0aWYoaW5pdCl7XHJcblx0XHRcdGdyb3VwLnggPSByZWN0LnggKyAocmVjdC53IC0gd2lkdGgpLzI7XHJcblx0XHRcdGdyb3VwLnkgPSByZWN0LnkgKyAocmVjdC5oIC0gaGVpZ2h0KS8yO1xyXG5cdFx0XHRncm91cC5zY2FsZS54ID0gZ3JvdXAuc2NhbGUueSA9IHNjYWxlO1xyXG5cdFx0XHRkb3RzLnggPSBkb3Rjb2wqKGdyaWQudGlsZVdpZHRoICsgZ3JpZC5tYXJnaW4pO1xyXG5cdFx0fWVsc2V7XHJcblx0XHRcdGdhbWUuYWRkLnR3ZWVuKGdyb3VwKS50byh7eDogcmVjdC54ICsgKHJlY3QudyAtIHdpZHRoKS8yLCB5OiByZWN0LnkgKyAocmVjdC5oIC0gaGVpZ2h0KS8yfSwgMzAwLCBcIkxpbmVhclwiLCB0cnVlKTtcclxuXHRcdFx0Z2FtZS5hZGQudHdlZW4oZ3JvdXAuc2NhbGUpLnRvKHt4OiBzY2FsZSwgeTogc2NhbGV9LCAzMDAsIFwiTGluZWFyXCIsIHRydWUpO1xyXG5cdFx0XHRnYW1lLmFkZC50d2Vlbihkb3RzKS50byh7eDogZG90Y29sKihncmlkLnRpbGVXaWR0aCArIGdyaWQubWFyZ2luKX0sIDMwMCwgXCJMaW5lYXJcIiwgdHJ1ZSk7XHJcblx0XHR9XHJcblx0fVxyXG5cdGFkanVzdChyZWN0LCB0cnVlKTtcclxuXHJcblx0ZnVuY3Rpb24gY29sdW1uSGFzVW5pdChpKXtcclxuXHRcdHZhciBmID0gZmFsc2U7XHJcblx0XHRmb3IobGV0IGogPSAwOyBqIDwgcm93czsgaisrKXtcclxuXHRcdFx0ZiA9IGYgfHwgdGlsZXNbal1baV0udmFsdWU7XHJcblx0XHR9XHJcblx0XHRyZXR1cm4gZjtcclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGFkZENvbHVtbihsZWZ0U2lkZSl7XHJcblx0XHRjb2xzKys7XHJcblx0XHRsZWZ0U2lkZSAmJiBkb3Rjb2wrKztcclxuXHRcdGZvcihsZXQgaSA9IDA7IGkgPCByb3dzOyBpKyspe1xyXG5cdFx0XHRsZXQgbmV3VGlsZSA9IG5ldyBUaWxlKHtcclxuXHRcdFx0XHRnYW1lLFxyXG5cdFx0XHRcdGdyb3VwLFxyXG5cdFx0XHRcdGdyaWQsXHJcblx0XHRcdFx0eDogY29scy0xLFxyXG5cdFx0XHRcdHk6IGksXHJcblx0XHRcdFx0dmFsdWU6IDAsXHJcblx0XHRcdFx0ZXZlbnRzXHJcblx0XHRcdH0pXHJcblx0XHRcdGlmKGxlZnRTaWRlKXtcclxuXHRcdFx0XHRuZXdUaWxlLnggPSAtMTtcclxuXHRcdFx0XHR0aWxlc1tpXS51bnNoaWZ0KG5ld1RpbGUpO1xyXG5cdFx0XHRcdHRpbGVzW2ldLmZvckVhY2goKHRpbGUsIGluZGV4KSA9PiB0aWxlLm1vdmVYKGluZGV4KSk7XHJcblx0XHRcdH1lbHNle1xyXG5cdFx0XHRcdHRpbGVzW2ldLnB1c2gobmV3VGlsZSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0ZnVuY3Rpb24gcmVtb3ZlQ29sdW1uKGxlZnRTaWRlKXtcclxuXHRcdGNvbHMtLTtcclxuXHRcdGxlZnRTaWRlICYmIGRvdGNvbC0tO1xyXG5cdFx0Zm9yKGxldCBpID0gMDsgaSA8IHJvd3M7IGkrKyl7XHJcblx0XHRcdGlmKGxlZnRTaWRlKXtcclxuXHRcdFx0XHR0aWxlc1tpXS5zaGlmdCgpLmRlc3Ryb3koKTtcclxuXHRcdFx0XHR0aWxlc1tpXS5mb3JFYWNoKCh0aWxlLCBpbmRleCkgPT4gdGlsZS5tb3ZlWChpbmRleCkpO1xyXG5cdFx0XHR9ZWxzZXtcclxuXHRcdFx0XHR0aWxlc1tpXS5wb3AoKS5kZXN0cm95KCk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIFRpbGUoe2dhbWUsIGdyb3VwLCBncmlkLCB4LCB5LCB2YWx1ZSwgZXZlbnRzfSl7XHJcblx0dmFyIHNlbGYgPSB0aGlzO1xyXG5cdHZhciBnID0gZ2FtZS5hZGQuc3ByaXRlKFxyXG5cdFx0eCooZ3JpZC50aWxlV2lkdGggKyBncmlkLm1hcmdpbiksXHJcblx0XHR5KihncmlkLnRpbGVIZWlnaHQgKyBncmlkLm1hcmdpbiksIFxyXG5cdFx0XCJ0aWxlXCIsXHJcblx0XHR2YWx1ZVxyXG5cdCk7XHJcblx0Z3JvdXAuYWRkKGcpO1xyXG5cdGcuaW5wdXRFbmFibGVkID0gdHJ1ZTtcclxuXHRnLmV2ZW50cy5vbklucHV0RG93bi5hZGQoKCkgPT4gZXZlbnRzLmNsaWNrKHNlbGYpKTtcclxuXHRcclxuXHR0aGlzLm1vdmVBbmRCYWNrID0gZnVuY3Rpb24oZHgsIGR5LCBmbGFnKXtcclxuXHRcdHZhciBneCA9IGcueCxcclxuXHRcdFx0Z3kgPSBnLnk7XHJcblx0XHRldmVudHMuYmVnaW5Ud2VlbigpO1xyXG5cdFx0aWYoZmxhZyl7XHJcblx0XHRcdGdhbWUuYWRkLnR3ZWVuKGcpLnRvKHtcclxuXHRcdFx0XHR4OiAoeCArIGR4KSooZ3JpZC50aWxlV2lkdGggKyBncmlkLm1hcmdpbiksIFxyXG5cdFx0XHRcdHk6ICh5ICsgZHkpKihncmlkLnRpbGVIZWlnaHQgKyBncmlkLm1hcmdpbilcclxuXHRcdFx0fSwgMzAwLCBcIkxpbmVhclwiLCB0cnVlKVxyXG5cdFx0XHQuY2hhaW4oXHJcblx0XHRcdFx0Z2FtZS5hZGQudHdlZW4oZykuZnJvbSh7YWxwaGE6IDB9LCAyMDAsIFwiTGluZWFyXCIpXHJcblx0XHRcdClcclxuXHRcdFx0Lm9uQ29tcGxldGUuYWRkKGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0Zy54ID0gZ3g7XHJcblx0XHRcdFx0Zy55ID0gZ3k7XHJcblx0XHRcdFx0ZXZlbnRzLmVuZFR3ZWVuKCk7XHJcblx0XHRcdH0pO1xyXG5cclxuXHRcdH1lbHNle1xyXG5cdFx0XHRnLnggPSAoeCArIGR4KSooZ3JpZC50aWxlV2lkdGggKyBncmlkLm1hcmdpbik7XHJcblx0XHRcdGcueSA9ICh5ICsgZHkpKihncmlkLnRpbGVIZWlnaHQgKyBncmlkLm1hcmdpbik7XHRcclxuXHRcdFx0Z2FtZS5hZGQudHdlZW4oZykudG8oe3g6IGd4LCB5OiBneX0sIDMwMCwgXCJMaW5lYXJcIiwgdHJ1ZSlcclxuXHRcdFx0XHQub25Db21wbGV0ZS5hZGQoZXZlbnRzLmVuZFR3ZWVuKTtcclxuXHRcdH1cclxuXHJcblx0fVxyXG5cdFxyXG5cdHRoaXMuc3dpdGNoID0gZnVuY3Rpb24oKXtcclxuXHRcdHZhbHVlID0gMSAtIHZhbHVlO1xyXG5cdFx0Zy5mcmFtZSA9IHZhbHVlO1xyXG5cdH1cclxuXHJcblx0dGhpcy5kZXN0cm95ID0gZnVuY3Rpb24oKXtcclxuXHRcdGcuZGVzdHJveSgpO1xyXG5cdH1cclxuXHJcblx0dGhpcy5tb3ZlWCA9IGZ1bmN0aW9uKF8pe1xyXG5cdFx0eCA9IF87XHJcblx0XHRnYW1lLmFkZC50d2VlbihnKS50byh7eDogeCooZ3JpZC50aWxlV2lkdGggKyBncmlkLm1hcmdpbil9LCAzMDAsIFwiTGluZWFyXCIsIHRydWUpO1xyXG5cdH1cclxuXHRPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0aGlzLCB7XHJcblx0XHR2YWx1ZToge1xyXG5cdFx0XHRnZXQ6ICgpID0+IHZhbHVlLFxyXG5cdFx0XHRzZXQ6IGZ1bmN0aW9uKF8pe1xyXG5cdFx0XHRcdHZhbHVlID0gXztcclxuXHRcdFx0XHRnLmZyYW1lID0gdmFsdWU7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHR4OiB7XHJcblx0XHRcdGdldDogKCkgPT4geCxcclxuXHRcdFx0c2V0OiBmdW5jdGlvbihfKXtcclxuXHRcdFx0XHR4ID0gXztcdFx0XHRcclxuXHRcdFx0XHRnLnggPSB4KihncmlkLnRpbGVXaWR0aCArIGdyaWQubWFyZ2luKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHRcdHk6IHtcclxuXHRcdFx0Z2V0OiAoKSA9PiB5LFxyXG5cdFx0XHRzZXQ6IGZ1bmN0aW9uKF8pe1xyXG5cdFx0XHRcdHkgPSBfO1xyXG5cdFx0XHRcdGcueSA9IHkqKGdyaWQudGlsZUhlaWdodCArIGdyaWQubWFyZ2luKTtcclxuXHRcdFx0fVxyXG5cdFx0fSxcclxuXHR9KTtcclxuXHJcbn0iXX0=

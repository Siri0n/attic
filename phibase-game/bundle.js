(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (global){
"use strict";

var Phaser = (typeof window !== "undefined" ? window['Phaser'] : typeof global !== "undefined" ? global['Phaser'] : null);

var game = new Phaser.Game(800, 600, Phaser.AUTO, '');

game.state.add("game", function () {
	return {
		preload: function preload() {
			/*			game.load.spritesheet("testball", "assets/testball.png", 64, 64);
   			game.load.start();*/
		},
		create: function create() {
			var field = window.field = new Field({
				game: game,
				rect: {
					x: 30,
					y: 30,
					h: 540,
					w: 740
				}
			});
		}
	};
}());

game.state.start("game");

function Field(_ref) {
	var game = _ref.game;
	var rect = _ref.rect;

	var grid = {
		tileWidth: 52,
		tileHeight: 78,
		margin: 16
	};
	var cols = 8;
	var rows = 5;
	var dotcol = 5;

	var group = game.add.group();
	function adjust(rect) {
		var width = (grid.tileWidth + grid.margin) * cols - grid.margin;
		var height = (grid.tileHeight + grid.margin) * rows - grid.margin;
		var scale = Math.min(rect.w / width, rect.h / height);
		width *= scale;
		height *= scale;
		group.x = rect.x + (rect.w - width) / 2;
		group.y = rect.y + (rect.h - height) / 2;
		group.scale.x = group.scale.y = scale;
	}
	adjust(rect);
	var tiles = [];
	var events = {
		click: function click(tile) {
			var i = tile.y,
			    j = tile.x;
			if (j >= cols - 2) {
				return;
			}
			var checksum1 = tile.value + tiles[i][j + 1].value;
			var checksum2 = tile.value + tiles[i][j + 2].value;
			if (checksum1 != 1 || checksum2 != 1) {
				return;
			}
			if (tile.value) {
				tile.switch();
				tiles[i][j + 1].switch();
				tiles[i][j + 2].switch();
				tiles[i][j + 1].moveAndBack(-1, 0);
				tiles[i][j + 2].moveAndBack(-2, 0);
			} else {
				tiles[i][j + 1].moveAndBack(-1, 0, function () {
					tile.switch();
					tiles[i][j + 1].switch();
				});
				tiles[i][j + 2].moveAndBack(-2, 0, function () {
					tiles[i][j + 2].switch();
				});
			}
		}
	};
	for (var i = 0; i < rows; i++) {
		var row = [];
		for (var j = 0; j < cols; j++) {
			row.push(new Tile({
				game: game,
				group: group,
				grid: grid,
				x: j,
				y: i,
				value: Math.random() > 0.5 ? 1 : 0,
				events: events
			}));
		}
		tiles.push(row);
	}

	this.test = function (i, j) {
		tiles[i][j].value = 1 - tiles[i][j].value;
	};
}

function Tile(_ref2) {
	var game = _ref2.game;
	var group = _ref2.group;
	var grid = _ref2.grid;
	var x = _ref2.x;
	var y = _ref2.y;
	var value = _ref2.value;
	var events = _ref2.events;

	var self = this;
	var g = game.add.graphics(x * (grid.tileWidth + grid.margin), y * (grid.tileHeight + grid.margin), group);
	g.inputEnabled = true;
	g.events.onInputDown.add(function () {
		return events.click(self);
	});
	var redraw = this.redraw = function () {
		g.clear();
		g.lineStyle(2, 0xffffff, 1);
		g.beginFill(0xf00ba5, 1).drawRect(0, 0, grid.tileWidth, grid.tileHeight).endFill();
		if (value) {
			g.lineStyle(10, 0, 1);
			g.beginFill(0, 1).moveTo(grid.tileWidth / 2, grid.tileHeight / 6).lineTo(grid.tileWidth / 2, grid.tileHeight * 5 / 6).endFill();
		}
	};
	redraw();

	this.moveAndBack = function (dx, dy, cb) {
		var gx = g.x,
		    gy = g.y;
		if (cb) {
			game.add.tween(g).to({
				x: (x + dx) * (grid.tileWidth + grid.margin),
				y: (y + dy) * (grid.tileHeight + grid.margin)
			}, 300, "Linear", true).chain(game.add.tween(g).from({ alpha: 0 }, 200, "Linear")).onComplete.add(function () {
				g.x = gx;
				g.y = gy;
				cb();
			});
		} else {
			g.x = (x + dx) * (grid.tileWidth + grid.margin);
			g.y = (y + dy) * (grid.tileHeight + grid.margin);
			game.add.tween(g).to({ x: gx, y: gy }, 300, "Linear", true);
		}
	};

	this.switch = function () {
		value = 1 - value;
		redraw();
	};

	Object.defineProperties(this, {
		value: {
			get: function get() {
				return value;
			},
			set: function set(_) {
				value = _;
				redraw();
			}
		},
		x: {
			get: function get() {
				return x;
			},
			set: function set(_) {
				x = _;
				g.x = x * (grid.tileWidth + grid.margin);
			}
		},
		y: {
			get: function get() {
				return y;
			},
			set: function set(_) {
				y = _;
				g.y = y * (grid.tileHeight + grid.margin);
			}
		}
	});
}

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJtYWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FDQUEsSUFBSSxTQUFTLFFBQVEsUUFBUixDQUFiOztBQUVBLElBQUksT0FBTyxJQUFJLE9BQU8sSUFBWCxDQUFnQixHQUFoQixFQUFxQixHQUFyQixFQUEwQixPQUFPLElBQWpDLEVBQXVDLEVBQXZDLENBQVg7O0FBRUEsS0FBSyxLQUFMLENBQVcsR0FBWCxDQUFlLE1BQWYsRUFBd0IsWUFBVTtBQUNqQyxRQUFPO0FBQ04sU0FETSxxQkFDRzs7O0FBR1IsR0FKSztBQUtOLFFBTE0sb0JBS0U7QUFDUCxPQUFJLFFBQVEsT0FBTyxLQUFQLEdBQWUsSUFBSSxLQUFKLENBQVU7QUFDcEMsY0FEb0M7QUFFcEMsVUFBTTtBQUNMLFFBQUcsRUFERTtBQUVMLFFBQUcsRUFGRTtBQUdMLFFBQUcsR0FIRTtBQUlMLFFBQUc7QUFKRTtBQUY4QixJQUFWLENBQTNCO0FBU0E7QUFmSyxFQUFQO0FBaUJBLENBbEJzQixFQUF2Qjs7QUFvQkEsS0FBSyxLQUFMLENBQVcsS0FBWCxDQUFpQixNQUFqQjs7QUFHQSxTQUFTLEtBQVQsT0FBNEI7QUFBQSxLQUFaLElBQVksUUFBWixJQUFZO0FBQUEsS0FBTixJQUFNLFFBQU4sSUFBTTs7QUFDM0IsS0FBTSxPQUFPO0FBQ1osYUFBVyxFQURDO0FBRVosY0FBWSxFQUZBO0FBR1osVUFBUTtBQUhJLEVBQWI7QUFLQSxLQUFJLE9BQU8sQ0FBWDtBQUNBLEtBQUksT0FBTyxDQUFYO0FBQ0EsS0FBSSxTQUFTLENBQWI7O0FBRUEsS0FBSSxRQUFRLEtBQUssR0FBTCxDQUFTLEtBQVQsRUFBWjtBQUNBLFVBQVMsTUFBVCxDQUFnQixJQUFoQixFQUFxQjtBQUNwQixNQUFJLFFBQVEsQ0FBQyxLQUFLLFNBQUwsR0FBaUIsS0FBSyxNQUF2QixJQUErQixJQUEvQixHQUFzQyxLQUFLLE1BQXZEO0FBQ0Es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LEVBQXJCLEVBQXFDLEdBQXJDLEVBQTBDLFFBQTFDLEVBQW9ELElBQXBEO0FBQ0E7QUFDRCxFQXRCRDs7QUF3QkEsTUFBSyxNQUFMLEdBQWMsWUFBVTtBQUN2QixVQUFRLElBQUksS0FBWjtBQUNBO0FBQ0EsRUFIRDs7QUFLQSxRQUFPLGdCQUFQLENBQXdCLElBQXhCLEVBQThCO0FBQzdCLFNBQU87QUFDTixRQUFLO0FBQUEsV0FBTSxLQUFOO0FBQUEsSUFEQztBQUVOLFFBQUssYUFBUyxDQUFULEVBQVc7QUFDZixZQUFRLENBQVI7QUFDQTtBQUNBO0FBTEssR0FEc0I7QUFRN0IsS0FBRztBQUNGLFFBQUs7QUFBQSxXQUFNLENBQU47QUFBQSxJQURIO0FBRUYsUUFBSyxhQUFTLENBQVQsRUFBVztBQUNmLFFBQUksQ0FBSjtBQUNBLE1BQUUsQ0FBRixHQUFNLEtBQUcsS0FBSyxTQUFMLEdBQWlCLEtBQUssTUFBekIsQ0FBTjtBQUNBO0FBTEMsR0FSMEI7QUFlN0IsS0FBRztBQUNGLFFBQUs7QUFBQSxXQUFNLENBQU47QUFBQSxJQURIO0FBRUYsUUFBSyxhQUFTLENBQVQsRUFBVztBQUNmLFFBQUksQ0FBSjtBQUNBLE1BQUUsQ0FBRixHQUFNLEtBQUcsS0FBSyxVQUFMLEdBQWtCLEtBQUssTUFBMUIsQ0FBTjtBQUNBO0FBTEM7QUFmMEIsRUFBOUI7QUF3QkEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIFBoYXNlciA9IHJlcXVpcmUoXCJwaGFzZXJcIik7XHJcblxyXG52YXIgZ2FtZSA9IG5ldyBQaGFzZXIuR2FtZSg4MDAsIDYwMCwgUGhhc2VyLkFVVE8sICcnKTtcclxuXHJcbmdhbWUuc3RhdGUuYWRkKFwiZ2FtZVwiLCAoZnVuY3Rpb24oKXtcclxuXHRyZXR1cm4ge1xyXG5cdFx0cHJlbG9hZCgpe1xyXG4vKlx0XHRcdGdhbWUubG9hZC5zcHJpdGVzaGVldChcInRlc3RiYWxsXCIsIFwiYXNzZXRzL3Rlc3RiYWxsLnBuZ1wiLCA2NCwgNjQpO1xyXG5cdFx0XHRnYW1lLmxvYWQuc3RhcnQoKTsqL1xyXG5cdFx0fSxcclxuXHRcdGNyZWF0ZSgpe1xyXG5cdFx0XHR2YXIgZmllbGQgPSB3aW5kb3cuZmllbGQgPSBuZXcgRmllbGQoe1xyXG5cdFx0XHRcdGdhbWUsXHJcblx0XHRcdFx0cmVjdDoge1xyXG5cdFx0XHRcdFx0eDogMzAsXHJcblx0XHRcdFx0XHR5OiAzMCxcclxuXHRcdFx0XHRcdGg6IDU0MCxcclxuXHRcdFx0XHRcdHc6IDc0MFxyXG5cdFx0XHRcdH1cclxuXHRcdFx0fSk7XHJcblx0XHR9XHJcblx0fVxyXG59KSgpKTtcclxuXHJcbmdhbWUuc3RhdGUuc3RhcnQoXCJnYW1lXCIpO1xyXG5cclxuXHJcbmZ1bmN0aW9uIEZpZWxkKHtnYW1lLCByZWN0fSl7XHJcblx0Y29uc3QgZ3JpZCA9IHtcclxuXHRcdHRpbGVXaWR0aDogNTIsXHJcblx0XHR0aWxlSGVpZ2h0OiA3OCxcclxuXHRcdG1hcmdpbjogMTZcclxuXHR9O1xyXG5cdHZhciBjb2xzID0gODtcclxuXHR2YXIgcm93cyA9IDU7XHJcblx0dmFyIGRvdGNvbCA9IDU7XHJcblxyXG5cdHZhciBncm91cCA9IGdhbWUuYWRkLmdyb3VwKCk7XHJcblx0ZnVuY3Rpb24gYWRqdXN0KHJlY3Qpe1xyXG5cdFx0dmFyIHdpZHRoID0gKGdyaWQudGlsZVdpZHRoICsgZ3JpZC5tYXJnaW4pKmNvbHMgLSBncmlkLm1hcmdpbjtcclxuXHRcdHZhciBoZWlnaHQgPSAoZ3JpZC50aWxlSGVpZ2h0ICsgZ3JpZC5tYXJnaW4pKnJvd3MgLSBncmlkLm1hcmdpbjtcclxuXHRcdHZhciBzY2FsZSA9IE1hdGgubWluKHJlY3Qudy93aWR0aCwgcmVjdC5oL2hlaWdodCk7XHJcblx0XHR3aWR0aCAqPSBzY2FsZTtcclxuXHRcdGhlaWdodCAqPSBzY2FsZTtcclxuXHRcdGdyb3VwLnggPSByZWN0LnggKyAocmVjdC53IC0gd2lkdGgpLzI7XHJcblx0XHRncm91cC55ID0gcmVjdC55ICsgKHJlY3QuaCAtIGhlaWdodCkvMjtcclxuXHRcdGdyb3VwLnNjYWxlLnggPSBncm91cC5zY2FsZS55ID0gc2NhbGU7XHJcblx0fVxyXG5cdGFkanVzdChyZWN0KTtcclxuXHR2YXIgdGlsZXMgPSBbXTtcclxuXHR2YXIgZXZlbnRzID0ge1xyXG5cdFx0Y2xpY2sodGlsZSl7XHJcblx0XHRcdHZhciBpID0gdGlsZS55LFxyXG5cdFx0XHRcdGogPSB0aWxlLng7XHJcblx0XHRcdGlmKGogPj0gY29scyAtIDIpe1xyXG5cdFx0XHRcdHJldHVybjtcclxuXHRcdFx0fVxyXG5cdFx0XHR2YXIgY2hlY2tzdW0xID0gdGlsZS52YWx1ZSArIHRpbGVzW2ldW2ogKyAxXS52YWx1ZTtcclxuXHRcdFx0dmFyIGNoZWNrc3VtMiA9IHRpbGUudmFsdWUgKyB0aWxlc1tpXVtqICsgMl0udmFsdWU7XHJcblx0XHRcdGlmKGNoZWNrc3VtMSAhPSAxIHx8IGNoZWNrc3VtMiAhPSAxKXtcclxuXHRcdFx0XHRyZXR1cm47XHJcblx0XHRcdH1cclxuXHRcdFx0aWYodGlsZS52YWx1ZSl7XHJcblx0XHRcdFx0dGlsZS5zd2l0Y2goKTtcclxuXHRcdFx0XHR0aWxlc1tpXVtqICsgMV0uc3dpdGNoKCk7XHJcblx0XHRcdFx0dGlsZXNbaV1baiArIDJdLnN3aXRjaCgpO1xyXG5cdFx0XHRcdHRpbGVzW2ldW2ogKyAxXS5tb3ZlQW5kQmFjaygtMSwgMCk7XHJcblx0XHRcdFx0dGlsZXNbaV1baiArIDJdLm1vdmVBbmRCYWNrKC0yLCAwKTtcclxuXHRcdFx0fWVsc2V7XHJcblx0XHRcdFx0dGlsZXNbaV1baiArIDFdLm1vdmVBbmRCYWNrKC0xLCAwLCBmdW5jdGlvbigpe1xyXG5cdFx0XHRcdFx0dGlsZS5zd2l0Y2goKTtcclxuXHRcdFx0XHRcdHRpbGVzW2ldW2ogKyAxXS5zd2l0Y2goKTtcclxuXHRcdFx0XHR9KTtcclxuXHRcdFx0XHR0aWxlc1tpXVtqICsgMl0ubW92ZUFuZEJhY2soLTIsIDAsIGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0XHR0aWxlc1tpXVtqICsgMl0uc3dpdGNoKCk7XHJcblx0XHRcdFx0fSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9XHJcblx0Zm9yKGxldCBpID0gMDsgaSA8IHJvd3M7IGkrKyl7XHJcblx0XHRsZXQgcm93ID0gW107XHJcblx0XHRmb3IobGV0IGogPSAwOyBqIDwgY29sczsgaisrKXtcclxuXHRcdFx0cm93LnB1c2gobmV3IFRpbGUoe1xyXG5cdFx0XHRcdGdhbWUsXHJcblx0XHRcdFx0Z3JvdXAsXHJcblx0XHRcdFx0Z3JpZCxcclxuXHRcdFx0XHR4OiBqLFxyXG5cdFx0XHRcdHk6IGksXHJcblx0XHRcdFx0dmFsdWU6IE1hdGgucmFuZG9tKCkgPiAwLjUgPyAxIDogMCxcclxuXHRcdFx0XHRldmVudHNcclxuXHRcdFx0fSkpO1xyXG5cdFx0fVxyXG5cdFx0dGlsZXMucHVzaChyb3cpO1xyXG5cdH1cclxuXHRcclxuXHR0aGlzLnRlc3QgPSBmdW5jdGlvbihpLCBqKXtcclxuXHRcdHRpbGVzW2ldW2pdLnZhbHVlID0gMSAtIHRpbGVzW2ldW2pdLnZhbHVlO1xyXG5cdH1cclxufVxyXG5cclxuZnVuY3Rpb24gVGlsZSh7Z2FtZSwgZ3JvdXAsIGdyaWQsIHgsIHksIHZhbHVlLCBldmVudHN9KXtcclxuXHR2YXIgc2VsZiA9IHRoaXM7XHJcblx0dmFyIGcgPSBnYW1lLmFkZC5ncmFwaGljcyhcclxuXHRcdHgqKGdyaWQudGlsZVdpZHRoICsgZ3JpZC5tYXJnaW4pLFxyXG5cdFx0eSooZ3JpZC50aWxlSGVpZ2h0ICsgZ3JpZC5tYXJnaW4pLCBcclxuXHRcdGdyb3VwXHJcblx0KTtcclxuXHRnLmlucHV0RW5hYmxlZCA9IHRydWU7XHJcblx0Zy5ldmVudHMub25JbnB1dERvd24uYWRkKCgpID0+IGV2ZW50cy5jbGljayhzZWxmKSk7XHJcblx0dmFyIHJlZHJhdyA9IHRoaXMucmVkcmF3ID0gZnVuY3Rpb24oKXtcclxuXHRcdGcuY2xlYXIoKTtcclxuXHRcdGcubGluZVN0eWxlKDIsIDB4ZmZmZmZmLCAxKTtcclxuXHRcdGcuYmVnaW5GaWxsKDB4ZjAwYmE1LCAxKVxyXG5cdFx0XHQuZHJhd1JlY3QoMCwgMCwgZ3JpZC50aWxlV2lkdGgsIGdyaWQudGlsZUhlaWdodClcclxuXHRcdFx0LmVuZEZpbGwoKTtcclxuXHRcdGlmKHZhbHVlKXtcclxuXHRcdFx0Zy5saW5lU3R5bGUoMTAsIDAsIDEpO1xyXG5cdFx0XHRnLmJlZ2luRmlsbCgwLCAxKVxyXG5cdFx0XHRcdC5tb3ZlVG8oZ3JpZC50aWxlV2lkdGgvMiwgZ3JpZC50aWxlSGVpZ2h0LzYpXHJcblx0XHRcdFx0LmxpbmVUbyhncmlkLnRpbGVXaWR0aC8yLCBncmlkLnRpbGVIZWlnaHQqNS82KVxyXG5cdFx0XHRcdC5lbmRGaWxsKCk7XHJcblx0XHR9XHJcblx0fVxyXG5cdHJlZHJhdygpO1xyXG5cdFxyXG5cdHRoaXMubW92ZUFuZEJhY2sgPSBmdW5jdGlvbihkeCwgZHksIGNiKXtcclxuXHRcdHZhciBneCA9IGcueCxcclxuXHRcdFx0Z3kgPSBnLnk7XHJcblx0XHRpZihjYil7XHJcblx0XHRcdGdhbWUuYWRkLnR3ZWVuKGcpLnRvKHtcclxuXHRcdFx0XHR4OiAoeCArIGR4KSooZ3JpZC50aWxlV2lkdGggKyBncmlkLm1hcmdpbiksIFxyXG5cdFx0XHRcdHk6ICh5ICsgZHkpKihncmlkLnRpbGVIZWlnaHQgKyBncmlkLm1hcmdpbilcclxuXHRcdFx0fSwgMzAwLCBcIkxpbmVhclwiLCB0cnVlKVxyXG5cdFx0XHQuY2hhaW4oXHJcblx0XHRcdFx0Z2FtZS5hZGQudHdlZW4oZykuZnJvbSh7YWxwaGE6IDB9LCAyMDAsIFwiTGluZWFyXCIpXHJcblx0XHRcdClcclxuXHRcdFx0Lm9uQ29tcGxldGUuYWRkKGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0Zy54ID0gZ3g7XHJcblx0XHRcdFx0Zy55ID0gZ3k7XHJcblx0XHRcdFx0Y2IoKTtcclxuXHRcdFx0fSk7XHJcblxyXG5cdFx0fWVsc2V7XHJcblx0XHRcdGcueCA9ICh4ICsgZHgpKihncmlkLnRpbGVXaWR0aCArIGdyaWQubWFyZ2luKTtcclxuXHRcdFx0Zy55ID0gKHkgKyBkeSkqKGdyaWQudGlsZUhlaWdodCArIGdyaWQubWFyZ2luKTtcdFxyXG5cdFx0XHRnYW1lLmFkZC50d2VlbihnKS50byh7eDogZ3gsIHk6IGd5fSwgMzAwLCBcIkxpbmVhclwiLCB0cnVlKTtcclxuXHRcdH1cclxuXHR9XHJcblx0XHJcblx0dGhpcy5zd2l0Y2ggPSBmdW5jdGlvbigpe1xyXG5cdFx0dmFsdWUgPSAxIC0gdmFsdWU7XHJcblx0XHRyZWRyYXcoKTtcclxuXHR9XHJcblxyXG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRoaXMsIHtcclxuXHRcdHZhbHVlOiB7XHJcblx0XHRcdGdldDogKCkgPT4gdmFsdWUsXHJcblx0XHRcdHNldDogZnVuY3Rpb24oXyl7XHJcblx0XHRcdFx0dmFsdWUgPSBfO1xyXG5cdFx0XHRcdHJlZHJhdygpO1xyXG5cdFx0XHR9XHJcblx0XHR9LFxyXG5cdFx0eDoge1xyXG5cdFx0XHRnZXQ6ICgpID0+IHgsXHJcblx0XHRcdHNldDogZnVuY3Rpb24oXyl7XHJcblx0XHRcdFx0eCA9IF87XHJcblx0XHRcdFx0Zy54ID0geCooZ3JpZC50aWxlV2lkdGggKyBncmlkLm1hcmdpbik7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0XHR5OiB7XHJcblx0XHRcdGdldDogKCkgPT4geSxcclxuXHRcdFx0c2V0OiBmdW5jdGlvbihfKXtcclxuXHRcdFx0XHR5ID0gXztcclxuXHRcdFx0XHRnLnkgPSB5KihncmlkLnRpbGVIZWlnaHQgKyBncmlkLm1hcmdpbik7XHJcblx0XHRcdH1cclxuXHRcdH0sXHJcblx0fSk7XHJcblxyXG59Il19
